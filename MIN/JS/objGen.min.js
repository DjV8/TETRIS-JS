function mod(e,o,t,n){e.forEach((e=>{const r=o[t+e];r.classList.contains("drawn")?r.classList.remove("drawn"):r.classList.add("drawn"),r.style.backgroundColor=n}))}document.addEventListener("DOMContentLoaded",(()=>{const e=["red","green","purple","blue","yellow","magenta","orange"],o=Array.from(document.querySelectorAll(".placeholder .row"));let t,n=Array.from(document.querySelectorAll("main div")),r=0,a=4,d=0,c=Math.floor(Math.random()*SHAPES.length),s=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*NEXTSHAPES.length),i=Math.floor(Math.random()*e.length),m=SHAPES[c],u=750,y=!0,h=10,S=0,f=0;function E(){m[d].some((e=>n[a+e+WIDTH].classList.contains("taken")))?3==++S&&(S=0,m[d].forEach((e=>n[a+e].classList.add("taken"))),c=l,s=i,l=Math.floor(Math.random()*NEXTSHAPES.length),i=Math.floor(Math.random()*e.length),m=SHAPES[c],a=4,d=0,mod(m[d],n,a,e[s]),mod(NEXTSHAPES[c],o,0,""),mod(NEXTSHAPES[l],o,0,e[i]),function(){for(let e=0;e<240;e+=WIDTH){let o=[];for(let t=0;t<WIDTH;t++)o[t]=e+t;if(o.every((e=>n[e].classList.contains("taken")))){r+=h,++f%5==0&&u>150&&(clearInterval(t),u-=100,h+=5,t=setInterval(E,u)),o.forEach((e=>{n[e].className="box",n[e].style.backgroundColor=""}));const a=n.splice(e,WIDTH);n=a.concat(n),n.forEach((e=>document.querySelector("main").appendChild(e)))}}}(),document.querySelector("#score").innerHTML=++r,m[d].some((e=>n[a+e].classList.contains("taken")))&&(clearInterval(t),y=!0,saveScore(r),writeHS("#highscores"),document.querySelector("#end").style.display="",document.querySelector("audio").pause())):(S=0,mod(m[d],n,a,""),a+=WIDTH,mod(m[d],n,a,e[s]))}function H(){mod(m[d],n,a,"");m[d].some((e=>[a+e]%WIDTH==0))||a--,m[d].some((e=>n[a+e].classList.contains("taken")))&&a++,mod(m[d],n,a,e[s])}function L(){mod(m[d],n,a,"");m[d].some((e=>[a+e]%WIDTH==WIDTH-1))||a++,m[d].some((e=>n[a+e].classList.contains("taken")))&&a--,mod(m[d],n,a,e[s])}function k(){(a+1)%WIDTH<5&&m[d].some((e=>(a+e+1)%WIDTH==0))&&k(++a),a%WIDTH>5&&m[d].some((e=>(a+e)%WIDTH==0))&&k(--a)}function p(){mod(m[d],n,a,""),d++,d==m.length&&(d=0),k(),mod(m[d],n,a,e[s])}document.querySelector("audio").volume=.1,document.addEventListener("keydown",(e=>{y||("w"==e.key||"ArrowUp"==e.key?p():"s"==e.key||"ArrowDown"==e.key?E():"a"==e.key||"ArrowLeft"==e.key?H():"d"!=e.key&&"ArrowRight"!=e.key||L())})),document.addEventListener("swiped-left",(function(e){H()})),document.addEventListener("swiped-right",(function(e){L()})),document.addEventListener("swiped-up",(function(e){p()})),document.addEventListener("swiped-down",(function(e){E()})),document.querySelector("#strt").addEventListener("click",(()=>{document.querySelectorAll(".pop-up")[0].style.display="none",y=!1,mod(m[d],n,a,e[s]),mod(NEXTSHAPES[l],o,0,e[i]),t=setInterval(E,u),document.querySelector("audio").play()})),document.querySelector("#restrt").addEventListener("click",(()=>{location.reload()}))}));